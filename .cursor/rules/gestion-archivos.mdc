---
description: Manejo de archivos con ArchivoHelper (discos y patrón)
globs: app/**/*.php
alwaysApply: false
---

# Gestión de Archivos

Siempre usar `ArchivoHelper` para gestionar archivos en el proyecto.

## Métodos disponibles:

- **`guardarArchivo($request, $campo, $disk, $archivoActual)`**: Guarda un archivo y elimina el anterior si existe. Retorna el nombre del archivo guardado o null.
- **`eliminarArchivo($path, $disk)`**: Elimina un archivo del disco especificado.
- **`obtenerUrl($path, $disk)`**: Obtiene la URL pública del archivo almacenado.
- **`guardarMultiples($request, $campo, $disk)`**: Guarda múltiples archivos. Retorna array de rutas.
- **`eliminarMultiples($paths, $disk)`**: Elimina múltiples archivos del disco.

## Discos disponibles:

- `temp_files`: Archivos temporales
- `avatars`: Avatares de usuarios
- `firmas`: Firmas digitales
- `radicados_recibidos`: Archivos de radicaciones
- `otros_archivos`: Otros archivos del sistema
- `local`: Almacenamiento local por defecto
- `public`: Almacenamiento público

## Uso:

- **SIEMPRE** usar estos métodos en lugar de manejar archivos directamente con `Storage` o `UploadedFile`.
- Si necesitas la ruta completa (ej: para PhpSpreadsheet), construirla desde la configuración del disco después de guardar:
  ```php
  $rutaArchivo = ArchivoHelper::guardarArchivo($request, 'archivo', 'temp_files');
  $diskConfig = config("filesystems.disks.temp_files");
  $rutaCompleta = $diskConfig['root'] . '/' . $rutaArchivo;
  ```

## Método getArchivoUrl en Modelos

**TODOS los modelos que manejen archivos** deben implementar el método genérico `getArchivoUrl()`:

```php
use App\Helpers\ArchivoHelper;

/**
 * Obtiene la URL de cualquier archivo usando ArchivoHelper.
 * @param string $campo Nombre del atributo (ej: 'archivo', 'archivo_digital', 'avatar')
 * @param string $disk Nombre del disco
 * @return string|null
 */
public function getArchivoUrl(string $campo, string $disk): ?string
{
    return ArchivoHelper::obtenerUrl($this->{$campo} ?? null, $disk);
}
```

**Ejemplos de uso en controladores:**
- En lugar de: `ArchivoHelper::obtenerUrl($archivo->archivo, 'radicaciones_recibidas')`
- Usar: `$archivo->getArchivoUrl('archivo', 'radicaciones_recibidas')`

**Beneficios:**
- Consistencia en todos los modelos
- Código más limpio y mantenible
- Facilita la reutilización del patrón
